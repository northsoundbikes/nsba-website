---
import { SEO } from "astro-seo";
import Layout from "../layouts/layout.astro";
import Map from "../components/map.svelte";

import { getCollection } from "astro:content";
const events = await getCollection("events");

export const title = "Home";
---

<Layout title={title}>
<section class="flex md:flex-row flex-col justify-between mx-auto max-w-7xl">	
    <div class="relative flex-grow md:basis-lg py-12 sm:py-20 px-4">
        <video
            autoplay
            muted
            loop
            playsinline
            poster="poster.png"
            class="absolute inset-0 w-full h-full object-cover z-0"
        >
            <source src="westgate_70.webm" type="video/webm" />
            <source src="westgate_70.mp4" type="video/mp4" />
            Your browser does not support the video tag.
        </video>
        <div class="absolute inset-0 bg-sky-950 opacity-90"></div>
        <div class="relative z-5 mx-auto max-w-2xl space-y-4 pr-8">
            <h1 class="text-3xl tracking-tight text-white md:text-4xl font-semibold">
                Because bicycling should be safe and easy for everyone.
            </h1>
            <p class="text-lg sm:text-xl sm:leading-snug text-white">
                NSBA works to improve infrastructure, promote biking, and ensure
                street safety in north King and south Snohomish counties.
            </p>
            <a
                href="get-involved"
                class="rounded-tr-lg bg-blue-600 px-6 py-4 text-md font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-indigo-600 inline-block"
                >Join us â†’</a
            >
        </div>
    </div>
    <section class="p-8 sm:py-16 lg:p-14 bg-amber-500 flex-1 md:basis-xs basis-0">
        <h3>Upcoming events</h3>
        {
            events.map((event) => {
                function fixMisinterpretedTimestamp(timestampStr, localTimeZone) {
                    // Step 1: Parse the timestamp as if it's in UTC (because of the incorrect 'Z' suffix)
                    let utcDate = new Date(timestampStr); // Interprets it as UTC incorrectly

                    // Step 2: Create a new Date object that treats it as local time
                    let localDate = new Date(
                        utcDate.getUTCFullYear(),
                        utcDate.getUTCMonth(),
                        utcDate.getUTCDate(),
                        utcDate.getUTCHours(),
                        utcDate.getUTCMinutes(),
                        utcDate.getUTCSeconds(),
                        utcDate.getUTCMilliseconds()
                    );

                    return localDate;
                }

                const startDate = fixMisinterpretedTimestamp(
                    event.data.startDate,
                    "America/Los_Angeles"
                );
                const endDate = fixMisinterpretedTimestamp(
                    event.data.startDate,
                    "America/Los_Angeles"
                );

                return (
                    <div class="event-item">
                        <h4 class="text-xl font-semibold">{event.data.title}</h4>
                        <p>{startDate.toLocaleString("en-US", { dateStyle: "full", timeStyle: "short", timeZone: "America/Los_Angeles" })}</p>
                    </div>
                );
            })
        }
		<h3>Recent news</h3>
		<h3>Get involved</h3>
    </section>
</section>
  <div class="px-6 py-14 lg:px-8 max-w-7xl mx-auto mb-10 h-auto">
    <h1 class="text-3xl font-semibold mb-6">What we're working on:</h1>
    <div class="flex flex-col sm:flex-row gap-4 items-center md:items-stretch">
      <div class="max-w-sm bg-blue-50 border border-gray-200 rounded-lg flex-1">
        <img class="rounded-t-lg" src="/involved/interurban.jpg" alt="" />
        <div class="p-5">
          <h5 class="mb-2 text-2xl font-medium tracking-tight font-serif">
            Building better bike networks
          </h5>
          <p class="mb-3 font-normal">
            Advocating for better trails and safer roads in Edmonds, Shoreline,
            Lynnwood, and MLT.
          </p>
        </div>
      </div>

      <div class="max-w-sm bg-blue-50 border border-gray-200 rounded-lg flex-1">
        <img class="rounded-t-lg" src="schools.jpeg" alt="" />
        <div class="p-5">
          <h5 class="mb-2 text-2xl font-medium tracking-tight font-serif">
            Sharing cycling skills
          </h5>
          <p class="mb-3 font-normal">
            Supporting educational efforts for young bikers â€“Â like the Let's Go
            education program.
          </p>
        </div>
      </div>

      <div class="max-w-sm bg-blue-50 border border-gray-200 rounded-lg flex-1">
        <img class="rounded-t-lg" src="/involved/gap.jpg" alt="" />
        <div class="p-5">
          <h5 class="mb-2 text-2xl font-medium tracking-tight font-serif">
            Bridging the Gap
          </h5>

          <p class="mb-3 font-normal">
            Convening local leaders to connect the "missing link" in the
            Interurban Trail between Shoreline & Edmonds at S.R. 104.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-blue-100 py-16" id="events">
    <div class="relative px-6 lg:px-8 max-w-7xl mx-auto">
      <h3 class="text-3xl font-bold mb-4">Upcoming events:</h3>
      <h4 class="text-xl font-semibold">
        Shoreline Bike Tour <span class="font-medium"
          >â€¢ Saturday, November 9th</span
        >
      </h4>
      <p>
        Come explore current & planned Shoreline infrastructure by bike! Hosted
        by <a
          href="https://urbanistshoreline.org"
          class="text-blue-600 underline">Urbanist Shoreline</a
        > & NSBA.
      </p>
      <ul class="list-disc list-inside mb-6">
        <li>Saturday, November 9th, 9:30am-12pm</li>
        <li>Meet at Shoreline Park & Ride: 18821 Aurora Ave N</li>
        <li>
          Snacks & e-bike test rides provided by <a
            href="https://wombi.us/"
            class="text-blue-600 underline">Wombi</a
          >
        </li>
        <li>RSVP requested!</li>
        <a
          href="https://docs.google.com/forms/d/e/1FAIpQLSdXqneMnt-Biz5xm54bHLYCjgjfvngaRNi8u740Fcc4mbtf2A/viewform"
        >
          <button
            type="submit"
            class="my-2 flex-none rounded-md bg-blue-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
            >RSVP for the Shoreline Bike Tour</button
          >
        </a>
      </ul>
      <h4 class="text-xl font-semibold">Weekly rides ðŸš´</h4>
      <p class="italic mb-2">
        Meet at Edmonds City Hall. Social pace, 8-12 miles.
      </p>
      <ul class="list-disc list-inside mb-6">
        <li>October 30th, 9:30am</li>
      </ul>
      <h4 class="text-xl font-semibold">Leadership meetings</h4>
      <p class="italic">Open to the public â€“Â come meet us!</p>
      <ul class="list-disc list-inside">
        <li>Wed, February 26, 6pm @ Lynnwood Library</li>
      </ul>
    </div>
  </div>
  <div class="bg-emerald-700 py-16 sm:py-24 lg:py-32">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <div
        class="max-w-2xl text-3xl font-bold tracking-tight text-white sm:text-4xl"
      >
        <h2 class="inline sm:block">Stay in the loop!</h2>
        <p class="inline sm:block font-medium">Sign up for our newsletter.</p>
      </div>
      <form
        class="mt-10 max-w-md"
        action="https://submit-form.com/cXqRJMofO"
        data-botpoison-public-key="pk_1b147c59-c2af-48d1-b704-1e6d2e79d05e"
      >
        <label for="email-address" class="sr-only">Email address</label>
        <input
          id="email-address"
          name="email"
          type="email"
          autocomplete="email"
          required
          class="min-w-0 flex-auto rounded-md border-0 px-3.5 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
          placeholder="Enter your email"
        />
        <button
          type="submit"
          class="flex-none rounded-md bg-blue-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
          >Subscribe</button
        >
        <p class="mt-4 text leading-6 text-white italic">
          Unsubscribe at any time.
        </p>
      </form>
    </div>
  </div>
</Layout>
